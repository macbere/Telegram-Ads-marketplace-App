<!DOCTYPE html>
<html>
<head>
    <title>TEST - Web App Working?</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        h1 { color: #0f0; }
        .info { 
            background: #333; 
            padding: 15px; 
            margin: 10px 0;
            border-radius: 8px;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>‚úÖ WEB APP IS WORKING!</h1>
    
    <div class="info">
        <strong>Telegram User:</strong> <span id="userName">Loading...</span>
    </div>
    
    <div class="info">
        <strong>User ID:</strong> <span id="userId">Loading...</span>
    </div>
    
    <div class="info">
        <strong>API URL:</strong> https://telegram-ads-marketplace-app.onrender.com
    </div>
    
    <button onclick="testChannels()">üîç Test Load Channels</button>
    <button onclick="testOrders()">üì¶ Test Load Orders</button>
    
    <div id="results" style="margin-top: 20px;"></div>
    
    <script>
        // Initialize Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        const userId = tg.initDataUnsafe?.user?.id || 0;
        const userName = tg.initDataUnsafe?.user?.first_name || 'Unknown';
        const API_URL = 'https://telegram-ads-marketplace-app.onrender.com';
        
        document.getElementById('userName').textContent = userName;
        document.getElementById('userId').textContent = userId || 'NOT FOUND';
        
        function log(msg, color = '#0f0') {
            const div = document.createElement('div');
            div.style.color = color;
            div.style.padding = '10px';
            div.style.background = '#222';
            div.style.margin = '5px 0';
            div.style.borderRadius = '5px';
            div.textContent = msg;
            document.getElementById('results').appendChild(div);
        }
        
        async function testChannels() {
            log('üîÑ Loading channels...');
            try {
                const response = await fetch(API_URL + '/channels/');
                const channels = await response.json();
                log('‚úÖ SUCCESS! Loaded ' + channels.length + ' channels', '#0f0');
                channels.slice(0, 3).forEach(ch => {
                    log('  üì¢ ' + ch.channel_title, '#fff');
                });
            } catch (e) {
                log('‚ùå ERROR: ' + e.message, '#f00');
            }
        }
        
        async function testOrders() {
            if (!userId) {
                log('‚ùå No user ID - open from Telegram!', '#f00');
                return;
            }
            
            log('üîÑ Loading orders for user ' + userId);
            try {
                const response = await fetch(API_URL + '/orders/user/' + userId);
                const orders = await response.json();
                
                if (orders.error) {
                    log('‚úÖ API works but no orders yet', '#ff0');
                } else {
                    log('‚úÖ SUCCESS! Found ' + orders.length + ' orders', '#0f0');
                }
            } catch (e) {
                log('‚ùå ERROR: ' + e.message, '#f00');
            }
        }
        
        // Auto-test on load
        setTimeout(() => {
            log('üöÄ Auto-testing API connection...');
            testChannels();
        }, 1000);
    </script>
</body>
</html>
