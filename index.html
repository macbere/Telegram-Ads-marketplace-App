<!DOCTYPE html>
<html>
<head>
    <title>DIAGNOSTIC - Ads Marketplace</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #000;
            color: #fff;
        }
        .test { 
            padding: 10px; 
            margin: 10px 0; 
            background: #222; 
            border-radius: 5px; 
        }
        .success { border-left: 4px solid #0f0; }
        .error { border-left: 4px solid #f00; }
        button { 
            padding: 12px 20px; 
            margin: 5px; 
            font-size: 16px; 
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>üîç DIAGNOSTIC MODE</h1>
    <div id="results"></div>
    
    <h2>Manual Tests:</h2>
    <button onclick="testAPI()">Test API Connection</button>
    <button onclick="testChannels()">Test Load Channels</button>
    <button onclick="testOrders()">Test Load Orders</button>
    
    <script>
        const log = (msg, isError = false) => {
            const div = document.createElement('div');
            div.className = 'test ' + (isError ? 'error' : 'success');
            div.textContent = msg;
            document.getElementById('results').appendChild(div);
            console.log(msg);
        };
        
        // Test 1: Telegram WebApp
        try {
            const tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
            log('‚úÖ Telegram WebApp initialized');
            log('‚úÖ User ID: ' + (tg.initDataUnsafe?.user?.id || 'NOT FOUND'));
        } catch (e) {
            log('‚ùå Telegram WebApp error: ' + e.message, true);
        }
        
        // Test 2: API URL
        const API_URL = 'https://telegram-ads-marketplace-app.onrender.com';
        log('‚úÖ API URL: ' + API_URL);
        
        // Test 3: Fetch test
        async function testAPI() {
            log('üîÑ Testing API connection...');
            try {
                const response = await fetch(API_URL + '/channels/');
                log('‚úÖ API Response Status: ' + response.status);
                const data = await response.json();
                log('‚úÖ API Data: ' + JSON.stringify(data).substring(0, 100));
            } catch (e) {
                log('‚ùå API Error: ' + e.message, true);
            }
        }
        
        async function testChannels() {
            log('üîÑ Loading channels...');
            try {
                const response = await fetch(API_URL + '/channels/');
                const channels = await response.json();
                log('‚úÖ Loaded ' + channels.length + ' channels');
                channels.forEach(ch => {
                    log('  - ' + ch.channel_title);
                });
            } catch (e) {
                log('‚ùå Channels error: ' + e.message, true);
            }
        }
        
        async function testOrders() {
            const tg = window.Telegram.WebApp;
            const userId = tg.initDataUnsafe?.user?.id;
            if (!userId) {
                log('‚ùå No user ID!', true);
                return;
            }
            
            log('üîÑ Loading orders for user ' + userId);
            try {
                const response = await fetch(API_URL + '/orders/user/' + userId);
                const orders = await response.json();
                log('‚úÖ Loaded orders: ' + JSON.stringify(orders).substring(0, 200));
            } catch (e) {
                log('‚ùå Orders error: ' + e.message, true);
            }
        }
        
        // Auto-run basic tests
        setTimeout(() => {
            log('üîÑ Running auto-tests...');
            testAPI();
        }, 1000);
    </script>
</body>
</html>
